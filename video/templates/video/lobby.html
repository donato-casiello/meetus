{% extends "base/index.html" %}
{% load static %}
{% block title %}Video Chat{% endblock title %}
{% block style %}
    <link type="text/css" rel="stylesheet" href="{% static 'video/video.css' %}">
{% endblock style %}

{% block content %}
    <main>
        <section id="form-container">
            <img id="logo" src="{% static 'video/images/logo2.png' %}" alt="videochat">

            <div id="welcome-message"> 
                <p id="welcome-parag">A group video calling application</p>
            </div>

            <form action="" id="form">
                <div class="form-field">
                    <input type="text" name="room" placeholder="Enter a room name">
                </div>

                <div class="form-field">
                    <input type="text" name="username" placeholder="Enter your name">
                </div>

                <div class="form-field">
                    <input type="submit" value="Join">
                </div>
            </form>
        </section>

    </main>

    <script type="text/javascript">
        let form = document.getElementById('form')
    
        let handleSubmit = async(e) => {
            e.preventDefault()
    
            let room = e.target.room.value
            let name = e.target.username.value
    
            let response = await fetch(`/video/getToken/?channel=${room}`)
            let data = await response.json()
    
            let UID = data.uid
            let token = data.token 
    
            sessionStorage.setItem("room", room) 
            sessionStorage.setItem("UID", UID) 
            sessionStorage.setItem("token", token) 
            sessionStorage.setItem("name", name) 
    
            window.open('/video/room/', '_self') 
        }
    
        form.addEventListener('submit', handleSubmit)
    </script>

    {% comment %} <script type="text/javascript" src="{% static 'video/video.js' %}"></script> {% endcomment %}
{% endblock content %}
